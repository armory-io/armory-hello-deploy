#!/bin/bash
DOCKER_RUN="docker run -i -t --rm"
GIT_HASH=$(git rev-parse HEAD | cut -c -7)
GIT_REPO=$(git config --local remote.origin.url | awk -F['/.'] '{ print $(NF-1) }')
DOCKER_IMAGE=${DOCKER_REGISTRY}/${GIT_REPO}:${GIT_HASH}

echo "testing: ${DOCKER_IMAGE}"
$DOCKER_RUN \
  -p 5000:5000 \
  -v ${BASE_DIR}/armory:/home/armory/armory \
  "${DOCKER_IMAGE}" \
  bash -c "pip install -e . && \
    nosetests -v --nocapture ./"
