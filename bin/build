#!/bin/bash
DOCKER_RUN="docker run -i -t --rm"
GIT_HASH=$(git rev-parse HEAD | cut -c -7)
GIT_REPO=$(git config --local remote.origin.url | awk -F['/.'] '{ print $(NF-1) }')
DOCKER_IMAGE=${DOCKER_REGISTRY}/${GIT_REPO}:${GIT_HASH}

echo "building: ${DOCKER_IMAGE}"

docker build -t "${DOCKER_IMAGE}" -f etc/Dockerfile .

rm -Rf MANIFEST ./build/ ./deb_dist ./dist/ *.tar.gz
exit 1
echo "building debian package"
$DOCKER_RUN \
  -v ${BASE_DIR}/:/home/armory/ \
  "${DOCKER_IMAGE}" \
  bash -c "python3 setup.py --command-packages=stdeb.command sdist_dsc --dist-dir=./build  bdist_deb"
  #bash -c "python3 setup.py --command-packages=stdeb.command bdist_deb"
