#!/bin/bash
source ./bin/common.env

echo "Pushing Image to Dockerhub"
docker push "${DOCKER_IMAGE}"

APP_NAME=armory-hello-deploy
VERSION=0.${CI_BUILD_NUMBER}.0-h${CI_BUILD_NUMBER}.${GIT_HASH}
DEB_FILE=${APP_NAME}_${VERSION}_all.deb
METADATA="deb_distribution=trusty;deb_component=main;publish=1;deb_architecture=i386,amd64"

REPO="debians-dev"
if [[ "${BRANCH_NAME}" == "master" ]];
  REPO="debians"
fi
BINTRAY_URL=https://api.bintray.com/content/armory/${REPO}/

curl -T ./build/${DEB_FILE} \
  -u${BINTRAY_USER}:${BINTRAY_APIKEY} \
   "${BINTRAY_URL}/${APP_NAME}/${VERSION}/${DEB_FILE};${METADATA}"
